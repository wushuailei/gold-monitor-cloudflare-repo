# å®šæ—¶ä»»åŠ¡è¯´æ˜Ž

## Cron é…ç½®

```toml
[triggers]
crons = ["*/1 * * * *"]
```

æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚

## æ‰§è¡Œæµç¨‹

```text
1. æ•°æ®æ¸…ç†æ£€æŸ¥ï¼ˆæ¯å¤© 00:00 æ‰§è¡Œä¸€æ¬¡ï¼‰
   â””â”€ æ¸…ç† 360 å¤©å‰çš„åŽ†å²æ•°æ®

2. æ¯æ—¥æ—©æŠ¥æ£€æŸ¥ï¼ˆæ¯å¤© 09:00 æ‰§è¡Œä¸€æ¬¡ï¼‰
   â”œâ”€ ç”Ÿæˆ AI å¸‚åœºåˆ†æžæŠ¥å‘Š
   â”œâ”€ å‘é€åˆ°é£žä¹¦ç¾¤
   â””â”€ ä¿å­˜åˆ° reports è¡¨

3. æ‹‰å–é‡‘ä»·
   â””â”€ ä»Žæ•°æ®æºèŽ·å–æœ€æ–°ä»·æ ¼

4. å†™å…¥æ•°æ®åº“
   â””â”€ æ’å…¥ prices è¡¨ï¼ˆé˜²é‡å¤ï¼‰

5. æ—¥çº¿æ±‡æ€»
   â””â”€ æ›´æ–° daily_prices è¡¨ï¼ˆå½“æ—¥æœ€é«˜/æœ€ä½Žä»·ï¼‰

6. å‘Šè­¦å¼•æ“Ž
   â”œâ”€ è®¡ç®—æ¶¨è·Œå¹…
   â”œâ”€ åˆ¤æ–­å‘Šè­¦ç­‰çº§
   â”œâ”€ æ£€æŸ¥èŠ‚æµè§„åˆ™
   â””â”€ å‘é€é£žä¹¦å‘Šè­¦

7. ç›®æ ‡ä»·æ£€æŸ¥
   â”œâ”€ æ£€æŸ¥ç”¨æˆ·é…ç½®çš„ç›®æ ‡ä»·
   â”œâ”€ åˆ¤æ–­æ˜¯å¦è§¦å‘
   â””â”€ å‘é€é£žä¹¦æé†’

8. AI åˆ†æžï¼ˆä»… CRIT çº§åˆ«ï¼‰
   â”œâ”€ è°ƒç”¨ AI æŽ¥å£
   â”œâ”€ ç”Ÿæˆåˆ†æžæŠ¥å‘Š
   â””â”€ å†™å…¥ reports è¡¨
```

## å‘Šè­¦å¼•æ“Žè§„åˆ™

### æ¶¨è·Œå¹…è®¡ç®—

åŸºäºŽç”¨æˆ·é…ç½®çš„å¯¹æ¯”åŸºå‡†ï¼š
- **YESTERDAY**ï¼šå¯¹æ¯”æ˜¨æ—¥æ”¶ç›˜ä»·
- **BUY**ï¼šå¯¹æ¯”æœªå¹³ä»“ä¹°å…¥ä»·

è®¡ç®—å…¬å¼ï¼š
```
change_percent = (price_now - ref_price) / ref_price * 100
```

### å‘Šè­¦èŠ‚ç‚¹

ç”¨æˆ·å¯é…ç½®ä¸‰çº§æ¶¨å¹…èŠ‚ç‚¹å’Œä¸‰çº§è·Œå¹…èŠ‚ç‚¹ï¼š
- **rise_1/2/3**ï¼šæ¶¨å¹…ä¸€/äºŒ/ä¸‰çº§èŠ‚ç‚¹ï¼ˆ%ï¼‰
- **fall_1/2/3**ï¼šè·Œå¹…ä¸€/äºŒ/ä¸‰çº§èŠ‚ç‚¹ï¼ˆ%ï¼‰

### åŽ»é‡ç­–ç•¥

- ä¸€çº§èŠ‚ç‚¹ï¼šæ¯å¤©æœ€å¤šæé†’ 1 æ¬¡
- äºŒçº§èŠ‚ç‚¹ï¼šæ¯å¤©æœ€å¤šæé†’ 2 æ¬¡
- ä¸‰çº§èŠ‚ç‚¹ï¼šæ¯å¤©æœ€å¤šæé†’ 3 æ¬¡

é€šè¿‡ `alerts` è¡¨çš„åŽ»é‡ç´¢å¼•å®žçŽ°ã€‚

## ç›®æ ‡ä»·æé†’è§„åˆ™

### è§¦å‘æ¡ä»¶

æ ¹æ®ç”¨æˆ·é…ç½®çš„æ¯”è¾ƒæ–¹å¼ï¼š
- **EQ**ï¼šprice_now == target_price
- **GTE**ï¼šprice_now >= target_price
- **LTE**ï¼šprice_now <= target_price

### è§¦å‘åŽå¤„ç†

1. å‘é€é£žä¹¦é€šçŸ¥
2. å°† `target_alert` è®¾ä¸º 0ï¼ˆå…³é—­æé†’ï¼‰
3. é¿å…é‡å¤æé†’

## é£žä¹¦å‘Šè­¦

### Webhook é…ç½®

ä½¿ç”¨ç¾¤è‡ªå®šä¹‰æœºå™¨äººï¼Œæ¶ˆæ¯ç±»åž‹ï¼š`text`

### å‘Šè­¦æ¶ˆæ¯æ ¼å¼

```json
{
  "msg_type": "text",
  "content": {
    "text": "[AU9999 é‡‘ä»·å‘Šè­¦]\nå½“å‰ä»·: 580.32\næ¶¨å¹…: +0.92%\nç­‰çº§: æ¶¨å¹…ä¸€çº§\nå¯¹æ¯”åŸºå‡†: æ˜¨æ—¥æ”¶ç›˜"
  }
}
```

### ç›®æ ‡ä»·æé†’æ ¼å¼

```json
{
  "msg_type": "text",
  "content": {
    "text": "[AU9999 ç›®æ ‡ä»·æé†’]\nðŸŽ¯ è§¦å‘ç›®æ ‡: 590.00 (çªç ´)\nå½“å‰ä»·: 590.15\nè®¾å®šæ—¶é—´: 2024-01-15 10:30"
  }
}
```

## AI åˆ†æžè§¦å‘

### è§¦å‘æ¡ä»¶

- å‘Šè­¦ç­‰çº§è¾¾åˆ° CRITï¼ˆä¸‰çº§èŠ‚ç‚¹ï¼‰
- åŒä¸€ symbol **30 åˆ†é’Ÿå†…æ— æˆåŠŸæŠ¥å‘Š**

### AI è¾“å…¥

```json
{
  "symbol": "AU9999",
  "price_now": 580.32,
  "change_percent": 0.92,
  "base_type": "YESTERDAY",
  "recent_prices": [
    { "ts": 1700000000, "price": 582.1 },
    ...
  ]
}
```

### AI è¾“å‡ºè¦æ±‚

Markdown æ ¼å¼ï¼ŒåŒ…å«ï¼š
- å¯èƒ½åŽŸå› åˆ†æž
- çŸ­çº¿é£Žé™©è¯„ä¼°
- æ“ä½œå»ºè®®ï¼ˆä¿å®ˆ / ä¸­æ€§ / æ¿€è¿›ï¼‰

## æ•°æ®æ¸…ç†ä»»åŠ¡

### æ‰§è¡Œæ—¶æœº

æ¯å¤©åŒ—äº¬æ—¶é—´ 00:00-00:05 ä¹‹é—´æ‰§è¡Œä¸€æ¬¡

### æ¸…ç†èŒƒå›´

åˆ é™¤ 360 å¤©ä¹‹å‰çš„æ•°æ®ï¼š
- pricesï¼ˆä»·æ ¼åˆ†é’Ÿçº¿ï¼‰
- daily_pricesï¼ˆæ—¥çº¿æ±‡æ€»ï¼‰
- alertsï¼ˆå‘Šè­¦è®°å½•ï¼‰
- reportsï¼ˆAI åˆ†æžæŠ¥å‘Šï¼‰
- tradesï¼ˆäº¤æ˜“è®°å½•ï¼‰

### åŽ»é‡æœºåˆ¶

ä½¿ç”¨ KV å­˜å‚¨è®°å½•æœ€åŽæ¸…ç†æ—¥æœŸï¼Œç¡®ä¿æ¯å¤©åªæ‰§è¡Œä¸€æ¬¡ã€‚

## æ¯æ—¥æ—©æŠ¥ä»»åŠ¡

### æ‰§è¡Œæ—¶æœº

æ¯å¤©åŒ—äº¬æ—¶é—´ 09:00-09:05 ä¹‹é—´æ‰§è¡Œä¸€æ¬¡

### æŠ¥å‘Šå†…å®¹

1. **åŸºç¡€æ•°æ®**
   - å½“å‰é‡‘ä»·
   - æ˜¨æ—¥æ”¶ç›˜ä»·
   - 24å°æ—¶æ¶¨è·Œå¹…

2. **AI åˆ†æž**
   - æ˜¨æ—¥èµ°åŠ¿å›žé¡¾
   - å½“å‰å¸‚åœºçŠ¶æ€
   - ä»Šæ—¥æ“ä½œå»ºè®®ï¼ˆä¿å®ˆ/ä¸­æ€§/æ¿€è¿›ï¼‰

3. **æ•°æ®æ¥æº**
   - æœ€è¿‘30åˆ†é’Ÿä»·æ ¼åºåˆ—
   - æ˜¨æ—¥æ”¶ç›˜ä»·å¯¹æ¯”
   - çŸ­æœŸæ¶¨è·Œå¹…è®¡ç®—

### æ¶ˆæ¯æ ¼å¼

```text
ðŸ“Š [AU é‡‘ä»·æ—©æŠ¥]
æ—¶é—´: 2024-01-15 09:00:00
å½“å‰ä»·: 580.32 å…ƒ/å…‹
æ˜¨æ—¥æ”¶ç›˜: 578.50 å…ƒ/å…‹
24hæ¶¨è·Œ: ðŸ“ˆ +0.31%

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

## å¯èƒ½åŽŸå› 
...

## çŸ­çº¿é£Žé™©
...

## æ“ä½œå»ºè®®
...

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
æ¨¡åž‹: gpt-4o-mini
```

### åŽ»é‡æœºåˆ¶

ä½¿ç”¨ KV å­˜å‚¨è®°å½•æœ€åŽå‘é€æ—¥æœŸï¼Œç¡®ä¿æ¯å¤©åªå‘é€ä¸€æ¬¡ã€‚

### æ•°æ®ä¿å­˜

æŠ¥å‘Šä¼šä¿å­˜åˆ° `reports` è¡¨ï¼Œtrigger_type ä¸º `DAILY`ã€‚

## å…è´¹é¢åº¦æŽ§åˆ¶

### Worker é™åˆ¶
- æ¯åˆ†é’Ÿä»»åŠ¡ â‰¤ 5 æ¬¡ D1 æŸ¥è¯¢
- AI è°ƒç”¨åªåœ¨ CRIT çº§åˆ«
- å‘Šè­¦æœ‰èŠ‚æµé™åˆ¶

### D1 é™åˆ¶
- æ‰€æœ‰æŸ¥è¯¢å¿…é¡»å‘½ä¸­ç´¢å¼•
- ç¦æ­¢å…¨è¡¨æ‰«æ
- ä½¿ç”¨ LIMIT é™åˆ¶è¿”å›žæ•°é‡

### ä¼˜åŒ–å»ºè®®
- åˆå¹¶ç›¸ä¼¼æŸ¥è¯¢
- ä½¿ç”¨æ‰¹é‡æ“ä½œ
- ç¼“å­˜å¸¸ç”¨æ•°æ®
