# 前端开发指南

## 技术栈

- React + TypeScript
- Vite
- TailwindCSS
- Lightweight Charts（图表库）
- date-fns（日期处理）

## 页面结构

### 主界面布局

```
┌─────────────────────────────────────────┐
│ Header（标题 + 刷新 + 设置目标价）       │
├─────────────────────────────────────────┤
│ 数据卡片（当前价、最高、最低、振幅）     │
├─────────────────────────────────────────┤
│ 统计卡片（持仓、浮动盈亏、已实现盈亏）   │
├─────────────────────────────────────────┤
│ 价格走势图（可点击标注买卖点）           │
├─────────────────────────────────────────┤
│ 日线汇总表格                            │
├─────────────────────────────────────────┤
│ 告警记录表格                            │
├─────────────────────────────────────────┤
│ 交易记录表格（含收益统计）               │
├─────────────────────────────────────────┤
│ AI 分析报告表格                         │
└─────────────────────────────────────────┘
```

## 核心功能

### 1. 价格走势图

**特性**：
- 显示分钟线数据（默认 24 小时）
- 支持时间范围切换（6h/12h/24h/3d/7d/15d/30d）
- 点击图表可标注买卖点
- 显示交易标记（买入绿色↑，卖出红色↓）
- 显示目标价线（虚线）

**交互**：
- 点击图表 → 弹出交易记录弹窗
- 自动填充时间和价格
- 选择买入/卖出，填写数量和备注

### 2. 数据卡片

显示实时数据：
- 当前价格 + 涨跌幅
- 24小时最高价
- 24小时最低价
- 24小时振幅

### 3. 收益统计

**持仓数量卡片**：
- 当前持仓克数
- 平均成本价

**浮动盈亏卡片**：
- 未卖出部分的盈亏
- 每克盈亏

**已实现盈亏卡片**：
- 已卖出部分的实际盈亏
- 已卖出克数

**总盈亏卡片**：
- 浮动盈亏 + 已实现盈亏
- 收益率百分比

### 4. 日线汇总表格

显示每日数据：
- 日期
- 品种（AU9999）
- 最高价（时间）
- 最低价（时间）
- 振幅
- 波动率

**特性**：
- 支持时间范围选择（1d/3d/7d/15d/30d/90d/180d/360d）
- 最大高度 600px，超出可滚动
- 表头固定

### 5. 告警记录表格

显示告警历史：
- 时间
- 类型（目标价/涨幅/跌幅）
- 对比基准（昨日收盘/买入价）
- 当前价格
- 基准价格
- 涨跌幅

**颜色规则**：
- 涨幅：红色
- 跌幅：绿色

### 6. 交易记录表格

显示交易历史：
- 时间
- 类型（买入/卖出）
- 品种
- 价格
- 数量
- 金额
- 备注

**收益统计**：
- 持仓数量和平均成本
- 浮动盈亏
- 已实现盈亏
- 总盈亏和收益率

### 7. AI 分析报告

显示 AI 生成的市场分析：
- 时间
- 品种
- 模型
- 价格
- 报告摘要
- 查看详情按钮

点击查看按钮弹出完整报告（Markdown 格式）。

### 8. 目标价管理

**设置目标价弹窗**：
- 目标价格输入
- 触发条件选择（≥/≤/=）
- 涨幅告警节点（一/二/三级）
- 跌幅告警节点（一/二/三级）

**活跃目标显示**：
- 显示当前设置的目标价
- 显示触发条件和备注
- 支持删除

## 时间范围选择

所有表格和图表都支持独立的时间范围选择：

**价格走势图**：6h/12h/24h/3d/7d/15d/30d  
**日线汇总**：1d/3d/7d/15d/30d/90d/180d/360d  
**告警记录**：1d/3d/7d/15d/30d/90d/180d/360d  
**交易记录**：1d/3d/7d/15d/30d/90d/180d/360d  
**AI 报告**：1d/3d/7d/15d/30d/90d/180d/360d

## 颜色规范

### 涨跌颜色（中国习惯）
- 涨：红色（#DC2626）
- 跌：绿色（#16A34A）

### 交易类型颜色
- 买入：绿色背景 + 绿色图标
- 卖出：红色背景 + 红色图标

### 告警类型颜色
- 目标价：蓝色
- 涨幅：红色
- 跌幅：绿色

### 盈亏颜色
- 盈利：红色
- 亏损：绿色

## API 调用

### 查询接口

```typescript
// 获取价格数据（小时）
api.getPrices(hours: number)

// 获取日线汇总（天）
api.getDailyPrices(days: number)

// 获取交易记录（天）
api.getTrades(days: number)

// 获取告警记录（天）
api.getAlerts(days: number)

// 获取 AI 报告（天）
api.getReports(days: number)

// 获取用户配置
api.getTargets()
```

### 写入接口

```typescript
// 创建交易记录
api.createTrade({
  ts: number,
  symbol: string,
  side: '买' | '卖',
  price: number,
  qty?: number,
  note?: string
})

// 创建/更新用户配置
api.createTarget({
  symbol: string,
  created_by: string,
  target_price?: number,
  target_alert: 0 | 1,
  target_cmp: 'EQ' | 'GTE' | 'LTE',
  rise_1?: number,
  rise_2?: number,
  rise_3?: number,
  fall_1?: number,
  fall_2?: number,
  fall_3?: number
})

// 删除用户配置
api.deleteTarget(id: number)
```

## 响应式设计

- 桌面端：多列布局
- 平板：2列布局
- 手机：单列布局
- 表格：横向滚动

## 性能优化

- 使用 React.memo 避免不必要的重渲染
- 图表数据按需加载
- 表格虚拟滚动（大数据量时）
- API 请求去重和缓存
